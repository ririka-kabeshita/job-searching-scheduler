<div id="company-list">
  <div class="header">企業一覧　画面</div>
  <div>
    <div style="padding-top: 1%">
      <button onClick="changeScreen('company-entry')">企業追加</button>
      <button onClick="changeScreen('schedule-list')">全ての予定</button>
      志望度
      <select id="company-desire" onchange="sortByDesire()">
        <option value="">-</option>
        <option value="high">高</option>
        <option value="middle">中</option>
        <option value="low">低</option>
      </select>
    </div>
    <ul style="padding: 1%" id="companys-list"></ul>
  </div>
</div>
<script>
  const companyList = document.getElementById("companys-list");

  google.script.run
    .withSuccessHandler((data) => {
      showCompany(data, companyList);
    })
    .getCompanysInfo();

  // 志望度を変更した時の処理
  function sortByDesire() {
    const companyDesire = document.getElementById("company-desire").value;
    while (companyList.lastChild) {
      companyList.removeChild(companyList.lastChild);
    }
    google.script.run
      .withSuccessHandler((data) => {
        showCompany(data, companyList);
      })
      .getCompanysByDesire(companyDesire);
  }

  //スケジュール・削除・編集ボタンの作成
  function createBtn(companyList, btnName, inner, className, btnFunction) {
    const btn = document.createElement("button");
    btn.setAttribute("class", className);
    btn.innerHTML = inner;
    btn.setAttribute("onclick", btnFunction);
    companyList.appendChild(btn);
  }
  // スケジュールボタンを押すと、各企業のカレンダーIDをセッションストレージにセットする
  function clickScheduleBtn(id) {
    sessionStorage.setItem("id", id);
    schedulelist();
    changeScreen("schedule-list");
  }

  // 企業名＋各ボタンを表示する
  function showCompany(data, companyList) {
    for (let i = 0; i < data.length; i++) {
      const companys = document.createElement("li");
      companyList.appendChild(companys);
      const company = document.createElement("a");
      company.innerText = data[i].name;
      const companyName = company.innerText;
      companys.appendChild(company);
      const calendarId = data[i].id;

      createBtn(
        company,
        "scheduleBtn",
        "スケジュール",
        "schedule-btn",
        `clickScheduleBtn("${calendarId}")`
      );
      createBtn(company, "fixBtn", "編集", "fix-btn", null);
      createBtn(company, "deleteBtn", "削除", "delete-btn", null);
    }
  }
</script>
