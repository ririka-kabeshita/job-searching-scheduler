<div id="schedule-list" class="no-display">
  <div class="header">予定一覧　画面</div>
  <ul id="within-one-week"></ul>
  <ul id="schedule"></ul>
  <div>
    <button onClick="changeScreen('schedule-entry')">予定作成</button>
    <button onClick="changeScreen('company-list')">企業一覧</button>
  </div>
</div>
<script>
  function schedulelist() {
    const calendarId = sessionStorage.getItem("id");
    const withinOneWeek = document.getElementById("within-one-week");
    const scheduleList = document.getElementById("schedule");
    scheduleList.innerHTML = null;
    withinOneWeek.innerHTML = null;

    google.script.run
      .withSuccessHandler((data) => {
        for (let i = 0; i < data.length; i++) {
          const result = judgmentWithinOneWeek(data[i].date);
          if (result == true) {
            const li = document.createElement("li");
            withinOneWeek.appendChild(li);
            li.setAttribute("class", "within-one-week");
            createScheduleList(li, data[i]);
          } else {
            const li = document.createElement("li");
            scheduleList.appendChild(li);
            li.setAttribute("class", "schedule-list");
            createScheduleList(li, data[i]);
          }
        }
      })
      .getSchedules(calendarId);
  }

  function fixScheduleBtn(id) {
    sessionStorage.setItem("eventId", id);
    const scheduleEntryHeader = document.getElementById(
      "schedule-entry-header"
    );
    // 予定登録画面から更新画面への切り替え
    scheduleEntryHeader.innerText = "予定の変更";
    const saveScheduleBtn = document.getElementById("save-schedule-btn");
    saveScheduleBtn.setAttribute("class", "no-display");
    const fixScheduleBtn = document.getElementById("fix-schedule-btn");
    fixScheduleBtn.setAttribute("class", "");
    changeScreen("schedule-entry");

    const eventId = sessionStorage.getItem("eventId");
    const calendarId = sessionStorage.getItem("id");

    const title = document.getElementById("title");
    const date = document.getElementById("date");
    const startTime = document.getElementById("start-time");
    const finishTime = document.getElementById("finish-time");
    const place = document.getElementById("place");
    const memo = document.getElementById("memo");

    google.script.run
      .withSuccessHandler((data) => {
        for (let i = 0; i < data.length; i++) {
          if (data[i].eventId == eventId) {
            title.value = data[i].title;
            date.value = data[i].date;
            startTime.value = data[i].startTime;
            finishTime.value = data[i].finishTime;
            place.value = data[i].location;
            memo.value = data[i].memo;
          }
        }
      })
      .getSchedules(calendarId);
  }

  function judgmentWithinOneWeek(date) {
    const today = new Date();
    const event = new Date(date);
    event.setDate(event.getDate() - 7);
    if (today >= event) {
      return true;
    } else {
      return;
    }
  }

  function createScheduleList(li, data) {
    const title = document.createElement("div");
    title.innerText = "タイトル : " + data.title;
    const date = document.createElement("div");
    date.innerText = "日付 : " + data.date;

    const startTime = document.createElement("div");
    startTime.innerText = "開始時刻：　" + data.startTime;
    const endTime = document.createElement("div");
    endTime.innerText = "終了時刻：　" + data.finishTime;

    const place = document.createElement("div");
    place.innerText = "場所 : " + data.location;

    const memo = document.createElement("div");
    memo.innerText = "memo : " + data.memo;

    const btns = document.createElement("div");
    btns.setAttribute("class", "schedule-btns");
    const scheduleFixBtn = document.createElement("button");
    scheduleFixBtn.innerText = "編集";
    scheduleFixBtn.setAttribute("onclick", `fixScheduleBtn("${data.eventId}")`);
    scheduleFixBtn.setAttribute("class", "fix-btn");

    const scheduleDeleteBtn = document.createElement("button");
    scheduleDeleteBtn.innerText = "削除";
    scheduleDeleteBtn.setAttribute("class", "delete-btn");
    btns.appendChild(scheduleFixBtn);
    btns.appendChild(scheduleDeleteBtn);

    li.appendChild(title);
    li.appendChild(date);
    li.appendChild(startTime);
    li.appendChild(endTime);
    li.appendChild(place);
    li.appendChild(memo);
    li.appendChild(btns);
  }
</script>
