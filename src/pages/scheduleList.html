<div id="schedule-list" class="no-display">
  <div class="header">予定一覧　画面</div>
  <ul id="within-one-week"></ul>
  <ul id="schedule"></ul>
  <div>
    <button onClick="changeScreen('schedule-entry')">予定作成</button>
    <button onClick="changeScreen('schedule-entry')">編集</button>
    <button onClick="changeScreen('company-list')">企業一覧</button>
  </div>
</div>
<script>
  function schedulelist() {
    const calendarId = sessionStorage.getItem("id");
    const withinOneWeek = document.getElementById("within-one-week");
    const scheduleList = document.getElementById("schedule");
    scheduleList.innerHTML = null;
    withinOneWeek.innerHTML = null;

    //　リファクタする。ボタンをつける（削除と編集）。
    google.script.run
      .withSuccessHandler((data) => {
        for (let i = 0; i < data.length; i++) {
          const result = checkWithinOneWeek(data[i].date);
          if (result == true) {
            const li = document.createElement("li");
            withinOneWeek.appendChild(li);
            li.setAttribute("class", "within-one-week");
            const title = document.createElement("div");
            title.innerText = "タイトル : " + data[i].title;
            const date = document.createElement("div");
            date.innerText = "日付　: " + data[i].date;

            const startTime = document.createElement("div");
            startTime.innerText = "開始時刻：　" + data[i].startTime;
            const endTime = document.createElement("div");
            endTime.innerText = "終了時刻：　" + data[i].endTime;

            const place = document.createElement("div");
            place.innerText = "場所 : " + data[i].location;

            const memo = document.createElement("div");
            memo.innerText = "memo : " + data[i].memo;

            const calendarFixBtn = document.createElement("button");
            calendarFixBtn.innerText = "編集";

            const calendarDeleteBtn = document.createElement("button");
            calendarDeleteBtn.innerText = "削除";

            li.appendChild(title);
            li.appendChild(date);
            li.appendChild(startTime);
            li.appendChild(endTime);
            li.appendChild(place);
            li.appendChild(memo);
            li.appendChild(calendarFixBtn);
            li.appendChild(calendarDeleteBtn);
          } else {
            const li = document.createElement("li");
            scheduleList.appendChild(li);
            li.setAttribute("class", "schedule-list");
            const title = document.createElement("div");
            title.innerText = "タイトル : " + data[i].title;
            const date = document.createElement("div");
            date.innerText = "日付 : " + data[i].date;

            const startTime = document.createElement("div");
            startTime.innerText = "開始時刻：　" + data[i].startTime;
            const endTime = document.createElement("div");
            endTime.innerText = "終了時刻：　" + data[i].endTime;

            const place = document.createElement("div");
            place.innerText = "場所 : " + data[i].location;

            const memo = document.createElement("div");
            memo.innerText = "memo : " + data[i].memo;

            const calendarFixBtn = document.createElement("button");
            calendarFixBtn.innerText = "編集";

            const calendarDeleteBtn = document.createElement("button");
            calendarDeleteBtn.innerText = "削除";

            li.appendChild(title);
            li.appendChild(date);
            li.appendChild(startTime);
            li.appendChild(endTime);
            li.appendChild(place);
            li.appendChild(memo);
            li.appendChild(calendarFixBtn);
            li.appendChild(calendarDeleteBtn);
          }
        }
      })
      .getSchedules(calendarId);
  }

  function checkWithinOneWeek(date) {
    const today = new Date();
    const event = new Date(date);
    event.setDate(event.getDate() - 7);
    if (today >= event) {
      return true;
    } else {
      return;
    }
  }
</script>
