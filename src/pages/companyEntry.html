<div id="company-entry" class="no-display">
  <div class="header" id="campany-entry-header">企業情報の登録</div>
  <form style="padding-top: 1%;" name="form">
    企業名 <input id="company-name" type="text" placeholder="企業名を入力してください" style="width:400px;" >
    </br>
    志望度 <select name="desire" id="desire">
      <option >-</option>
      <option value="high">高</option>
      <option value="middle">中</option>
      <option value="low">低</option>
    </select>
</form>
    <button id="company-entry-btn" type="button" onClick="createCalendar()" style="margin-top:1%;">登録</button></br>
    <button id="company-fix-btn" type="button"  style="margin-top:1%;" class="no-display" onclick="fixCalendar()">更新</button></br>
  <button onClick="reloadCompanyEntry()" style="margin-top:1%;">企業一覧</button>
</div>
<script>
  function createCalendar(){
    const companyEntryBtn=document.getElementById("company-entry-btn");
    companyEntryBtn.setAttribute("class","");
    const companyFixBtn=document.getElementById("company-fix-btn");
    companyFixBtn.setAttribute("class","no-display");
    const companyName = document.getElementById('company-name').value;
    const desire = document.form.desire;
    const num = desire.selectedIndex;
    const desireValue = desire.options[num].value;
   
    if(!companyName |!desireValue){
      alert("企業名と志望度を入力してください");
    }else{
      google.script.run.withSuccessHandler((data)=>{
        alert(data ?'登録を完了しました' : '同じ企業名のカレンダーが存在します'); 
        document.getElementById('company-name').value=null;
        document.getElementById('desire').value="-";
        const companyList = document.getElementById("companys-list");
        companyList.innerHTML=null;
        reloadCompanyList();
        }).createCompanyCalendar(companyName,desireValue);
    }
  }

  function fixCalendar(){
    const companyName = document.getElementById('company-name').value;
    const desire = document.form.desire;
    const num = desire.selectedIndex;
    const desireValue = desire.options[num].value;
    const calendarId=sessionStorage.getItem("id");
        if(!companyName |!desireValue){
      alert("企業名と志望度を入力してください");
    }else{
      google.script.run.withSuccessHandler((data)=>{
        alert(data ?'企業情報を変更しました' : '同じ企業名のカレンダーが存在します'); 
        document.getElementById('company-name').value=null;
        document.getElementById('desire').value=null;
        reloadCompanyEntry();
        // 企業一覧画面の初期化
        const companyList = document.getElementById("companys-list");
        companyList.innerHTML=null;
        reloadCompanyList();
        changeScreen("company-list");
      }).fixCompanyCalendar(companyName,desireValue,calendarId);
    }
  }

function reloadCompanyEntry(){
  const companyEntryHeader=document.getElementById("campany-entry-header");
  companyEntryHeader.value="企業情報の登録";
  const companyEntryBtn=document.getElementById("company-entry-btn");
  companyEntryBtn.setAttribute("class","");
  const companyFixBtn=document.getElementById("company-fix-btn");
  companyFixBtn.setAttribute("class","no-display");
  changeScreen('company-list');
}
</script>
